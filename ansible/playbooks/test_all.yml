---
- name: Test All Role Tasks
  hosts: localhost
  connection: local
  become: false
  tasks:
    # Common role tests
    - name: 📂 Test directory creation
      ansible.builtin.debug:
        msg: "Would create directory {{ item }}"
      loop:
        - "{{ lookup('env', 'HOME') }}/.config"
        - "~/code"
      tags: [common, test]

    # Git role tests
    - name: 💾 Test Git installation
      ansible.builtin.debug:
        msg: "Would install git package"
      tags: [git, test]

    - name: 🔗 Test Git dotfiles linking
      include_tasks: ../roles/common/tasks/includes/link_dotfiles.yml
      vars:
        dotfiles:
          - { src: 'gitconfig', dest: '.gitconfig.test' }
        role_name: git
        source_path: /home/roadhouse/code/dotfiles/ansible/roles/git
      tags: [git, test]

    # Ruby role tests
    - name: 💾 Test rbenv installation
      ansible.builtin.debug:
        msg: "Would run: curl -fsSL https://rbenv.org/install.sh | /usr/bin/bash"
      tags: [ruby, test]

    - name: 💎 Test Ruby installation
      ansible.builtin.debug:
        msg: "Would install Ruby {{ ruby_version }}"
      vars:
        ruby_version: "3.4.3"
      tags: [ruby, test]

    - name: 🔗 Test Ruby dotfiles linking
      include_tasks: ../roles/common/tasks/includes/link_dotfiles.yml
      vars:
        dotfiles:
          - { src: 'irbrc', dest: '.irbrc.test' }
          - { src: 'pryrc', dest: '.pryrc.test' }
        role_name: ruby
        source_path: /home/roadhouse/code/dotfiles/ansible/roles/ruby
      tags: [ruby, test]

    # Nushell role tests
    - name: 🔐 Test Nushell GPG key
      ansible.builtin.debug:
        msg: "Would add Nushell GPG key"
      tags: [nushell, test]

    - name: 📚 Test Nushell repository
      ansible.builtin.debug:
        msg: "Would add Nushell repository"
      tags: [nushell, test]

    - name: 🔗 Test Nushell config linking
      include_tasks: ../roles/common/tasks/includes/link_dotfiles.yml
      vars:
        dotfiles:
          - { src: 'config', dest: '.config/nushell.test' }
        role_name: nushell
        source_path: /home/roadhouse/code/dotfiles/ansible/roles/nushell
      tags: [nushell, test]

    - name: 💾 Test Nushell installation
      ansible.builtin.debug:
        msg: "Would install nushell package"
      tags: [nushell, test]
